<!-- resources/education.html -->
{% extends "base.html" %}

{% block title %}–û–±—Ä–∞–∑–æ–≤–Ω–∏ —Å–æ–¥—Ä–∂–∏–Ω–∏ - –ú–µ–Ω—Ç–∞–ª–Ω–æ–ó–¥—Ä–∞–≤—ò–µ{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <div class="text-center mb-12">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mb-6">
            <span class="text-4xl">üìñ</span>
        </div>
        <h1 class="text-4xl font-bold text-blue-700 mb-4">–û–±—Ä–∞–∑–æ–≤–Ω–∏ —Å–æ–¥—Ä–∂–∏–Ω–∏</h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
            –ù–∞—É—á–∏ –ø–æ–≤–µ—ú–µ –∑–∞ –º–µ–Ω—Ç–∞–ª–Ω–æ—Ç–æ –∑–¥—Ä–∞–≤—ò–µ –∏ —Ç–µ—Ö–Ω–∏–∫–∏ –∑–∞ —Å–ø—Ä–∞–≤—É–≤–∞—ö–µ —Å–æ —Å–µ–∫–æ—ò–¥–Ω–µ–≤–Ω–∏—Ç–µ –ø—Ä–µ–¥–∏–∑–≤–∏—Ü–∏
        </p>
    </div>

    <!-- Category Filter -->
    {% if categories %}
    <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-700 mb-4">–§–∏–ª—Ç—Ä–∏—Ä–∞—ò –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</h2>
        <div class="flex flex-wrap gap-3">
            <button onclick="filterCategory('all')" class="category-filter active bg-purple-600 text-white px-4 py-2 rounded-full font-medium hover:bg-purple-700 transition-colors">
                –°–∏—Ç–µ
            </button>
            {% for category in categories %}
            <button onclick="filterCategory('{{ category }}')" class="category-filter bg-purple-100 text-purple-700 px-4 py-2 rounded-full font-medium hover:bg-purple-200 transition-colors">
                {{ category }}
            </button>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Search Bar -->
    <div class="mb-8">
        <div class="relative max-w-md mx-auto">
            <input type="text" id="searchInput" placeholder="–ü—Ä–µ–±–∞—Ä–∞—ò —Å–æ–¥—Ä–∂–∏–Ω–∏..."
                   class="input-field pl-12 pr-4" onkeyup="searchContent()">
            <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                <span class="text-xl">üîç</span>
            </div>
        </div>
    </div>

    <!-- Content Grid -->
    <div id="contentGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for article in content %}
        <article class="content-item card hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1"
                 data-category="{{ article.category }}" data-tags="{{ article.tags }}">
            <!-- Category Badge -->
            <div class="flex justify-between items-start mb-4">
                <span class="inline-block bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-medium">
                    {{ article.category }}
                </span>
                <div class="flex items-center text-gray-500 text-sm">
                    <span class="mr-1">‚è±Ô∏è</span>
                    <span>{{ article.reading_time }} –º–∏–Ω</span>
                </div>
            </div>

            <!-- Title -->
            <h3 class="text-xl font-bold text-gray-800 mb-3 line-clamp-2">
                {{ article.title }}
            </h3>

            <!-- Content Preview -->
            <div class="text-gray-600 mb-4 text-sm leading-relaxed">
                {% set content_preview = article.content[:200] + '...' if article.content|length > 200 else article.content %}
                {{ content_preview | replace('**', '') | replace('#', '') }}
            </div>

            <!-- Tags -->
            {% if article.tags %}
            <div class="flex flex-wrap gap-2 mb-6">
                {% for tag in article.tags.split(',') %}
                <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">
                    #{{ tag.strip() }}
                </span>
                {% endfor %}
            </div>
            {% endif %}


        </article>
        {% endfor %}
    </div>

    <!-- No Results Message -->
    <div id="noResults" class="hidden text-center py-12">
        <div class="text-6xl mb-4">üîç</div>
        <h3 class="text-xl font-bold text-gray-600 mb-2">–ù–µ–º–∞ –ø—Ä–æ–Ω–∞—ò–¥–µ–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</h3>
        <p class="text-gray-500">–ü—Ä–æ–±–∞—ò —Å–æ —Ä–∞–∑–ª–∏—á–Ω–∏ –∫–ª—É—á–Ω–∏ –∑–±–æ—Ä–æ–≤–∏ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
    </div>
</div>

<!-- Article Modal -->
<div id="articleModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
        <!-- Modal Header -->
        <div class="flex justify-between items-center p-6 border-b border-gray-200">
            <div class="flex items-center space-x-3">
                <span id="modalCategory" class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-medium"></span>
                <div class="flex items-center text-gray-500 text-sm">
                    <span class="mr-1">‚è±Ô∏è</span>
                    <span id="modalReadingTime"></span>
                </div>
            </div>
            <button onclick="closeArticle()" class="text-gray-500 hover:text-gray-700 text-2xl">
                &times;
            </button>
        </div>

        <!-- Modal Content -->
        <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
            <div class="p-6">
                <h2 id="modalTitle" class="text-3xl font-bold text-gray-800 mb-6"></h2>
                <div id="modalContent" class="prose prose-purple max-w-none"></div>
            </div>
        </div>

        <!-- Modal Footer -->
        <div class="border-t border-gray-200 p-6 bg-gray-50">
            <div class="flex justify-between items-center">
                <div id="modalTags" class="flex flex-wrap gap-2"></div>
                <div class="flex gap-3">
                    <button onclick="shareArticle()" class="btn-secondary">
                        üì§ –°–ø–æ–¥–µ–ª–∏
                    </button>
                    <button onclick="closeArticle()" class="btn-primary">
                        –ó–∞—Ç–≤–æ—Ä–∏
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Store articles data for JavaScript access
const articles = test;

// Category filtering
function filterCategory(category) {
    const items = document.querySelectorAll('.content-item');
    const buttons = document.querySelectorAll('.category-filter');

    // Update active button
    buttons.forEach(btn => btn.classList.remove('active', 'bg-purple-600', 'text-white'));
    buttons.forEach(btn => btn.classList.add('bg-purple-100', 'text-purple-700'));

    event.target.classList.add('active', 'bg-purple-600', 'text-white');
    event.target.classList.remove('bg-purple-100', 'text-purple-700');

    // Filter items
    let visibleCount = 0;
    items.forEach(item => {
        const itemCategory = item.getAttribute('data-category');
        if (category === 'all' || itemCategory === category) {
            item.style.display = 'block';
            visibleCount++;
        } else {
            item.style.display = 'none';
        }
    });

    // Show/hide no results message
    document.getElementById('noResults').classList.toggle('hidden', visibleCount > 0);
}

// Search functionality
function searchContent() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const items = document.querySelectorAll('.content-item');

    let visibleCount = 0;
    items.forEach(item => {
        const title = item.querySelector('h3').textContent.toLowerCase();
        const content = item.querySelector('.text-gray-600').textContent.toLowerCase();
        const tags = item.getAttribute('data-tags').toLowerCase();

        if (title.includes(searchTerm) || content.includes(searchTerm) || tags.includes(searchTerm)) {
            item.style.display = 'block';
            visibleCount++;
        } else {
            item.style.display = 'none';
        }
    });

    // Show/hide no results message
    document.getElementById('noResults').classList.toggle('hidden', visibleCount > 0);
}

// Article modal functions
function openArticle(index) {
    const article = articles[index];

    document.getElementById('modalTitle').textContent = article.title;
    document.getElementById('modalCategory').textContent = article.category;
    document.getElementById('modalReadingTime').textContent = article.reading_time + ' –º–∏–Ω';

    // Format content with basic markdown-like formatting
    let formattedContent = article.content
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n- /g, '</p><ul><li>')
        .replace(/\n/g, '<br>');

    // Handle lists better
    formattedContent = formattedContent.replace(/(<li>.*?)<br>/g, '$1</li><li>');
    formattedContent = formattedContent.replace(/<li>(.*?)<\/p>/g, '<li>$1</li></ul><p>');
    formattedContent = '<p>' + formattedContent + '</p>';

    // Clean up any empty paragraphs
    formattedContent = formattedContent.replace(/<p><\/p>/g, '');

    document.getElementById('modalContent').innerHTML = formattedContent;

    // Handle tags
    const tagsContainer = document.getElementById('modalTags');
    tagsContainer.innerHTML = '';
    if (article.tags) {
        article.tags.split(',').forEach(tag => {
            const tagSpan = document.createElement('span');
            tagSpan.className = 'bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs';
            tagSpan.textContent = '#' + tag.trim();
            tagsContainer.appendChild(tagSpan);
        });
    }

    document.getElementById('articleModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeArticle() {
    document.getElementById('articleModal').classList.add('hidden');
    document.body.style.overflow = 'auto';
}

function shareArticle() {
    const title = document.getElementById('modalTitle').textContent;
    const text = `–ü—Ä–æ—á–∏—Ç–∞—ò —ò–∞ –æ–≤–∞–∞ –∫–æ—Ä–∏—Å–Ω–∞ —Å—Ç–∞—Ç–∏—ò–∞: "${title}"`;

    if (navigator.share) {
        navigator.share({
            title: title,
            text: text,
            url: window.location.href
        });
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(text + ' - ' + window.location.href)
            .then(() => showNotification('–õ–∏–Ω–∫–æ—Ç –µ –∫–æ–ø–∏—Ä–∞–Ω!', 'success'))
            .catch(() => showNotification('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–∞—ö–µ', 'error'));
    }
}

// Close modal when clicking outside
document.getElementById('articleModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeArticle();
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeArticle();
    }
});
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.prose {
    line-height: 1.7;
}

.prose p {
    margin-bottom: 1rem;
}

.prose strong {
    font-weight: 600;
    color: #6b21a8;
}

.prose ul {
    margin: 1rem 0;
    padding-left: 1.5rem;
}

.prose li {
    margin-bottom: 0.5rem;
}

.category-filter.active {
    box-shadow: 0 4px 14px 0 rgba(168, 85, 247, 0.39);
}

@media (max-width: 768px) {
    #articleModal .bg-white {
        margin: 1rem;
        max-height: calc(100vh - 2rem);
    }
}
    </style>